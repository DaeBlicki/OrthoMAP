#'-----------------------------------------------------------------------------
#' @title   Compare Resolution
#'
#' @concept
#' Compares the harmonized shannon entropy between clusters generated by the
#' OrthoMAP workflow in the fine-clustering. It compares resolutions. The
#' results must be in form of `csv` and must have column `Shannon_Entropy`.
#'
#' @description
#' It calculates the boxplot for the two different methods. It uses the
#' concatenated results of all different inputs.
#'
#' @author  David Blickenstorfer, Technau Group (2025)
#' @created 1/08/2025
#'
#' Version: v1.0.0
#' Changelog:
#'  - v1.0.0: Initial release
#'
#' @copyright Technau Group, University of Vienna, 2025
#' @copyright Boeva Lab, ETH Zurich, 2025
#' ----------------------------------------------------------------------------
# Load library
library(tidyverse)
color_vector <- c(
  "OMA" = "#f06180",
  "HOG [mmseqs2]" = "#54bae9",
  "HOG [diamond]" = "#c588eb",
  "OOG [mmseqs2]" = "#7bd47b",
  "OOG [diamond]" = "#dbdb81"
)
methodnames <- c("OMA", "HOG [mmseqs2]", "HOG [diamond]",
                 "OOG [mmseqs2]", "OOG [diamond]")
# -----------------------------------------------------------------------------
# Step 1: Load Data and Preparation
# -----------------------------------------------------------------------------
result_path <- file.path("results", "OrthoMAP_Statistical_Results")
res_01_path <- c(
  file.path(result_path, "oma", "5", "local_statistic.csv"),
  file.path(result_path, "mmseqs2", "HOG", "5", "local_statistic.csv"),
  file.path(result_path, "diamond", "HOG", "5", "local_statistic.csv"),
  file.path(result_path, "mmseqs2", "OOG", "5", "local_statistic.csv"),
  file.path(result_path, "diamond", "OOG", "5", "local_statistic.csv")
)
res_02_path <- c(
  file.path(result_path, "oma", "6", "local_statistic.csv"),
  file.path(result_path, "mmseqs2", "HOG", "6", "local_statistic.csv"),
  file.path(result_path, "diamond", "HOG", "6", "local_statistic.csv"),
  file.path(result_path, "mmseqs2", "OOG", "6", "local_statistic.csv"),
  file.path(result_path, "diamond", "OOG", "6", "local_statistic.csv")
)

res_03_path <- c(
  file.path(result_path, "oma", "7", "local_statistic.csv"),
  file.path(result_path, "mmseqs2", "HOG", "7", "local_statistic.csv"),
  file.path(result_path, "diamond", "HOG", "7", "local_statistic.csv"),
  file.path(result_path, "mmseqs2", "OOG", "7", "local_statistic.csv"),
  file.path(result_path, "diamond", "OOG", "7", "local_statistic.csv")
)

res_04_path <- c(
  file.path(result_path, "oma", "8", "local_statistic.csv"),
  file.path(result_path, "mmseqs2", "HOG", "8", "local_statistic.csv"),
  file.path(result_path, "diamond", "HOG", "8", "local_statistic.csv"),
  file.path(result_path, "mmseqs2", "OOG", "8", "local_statistic.csv"),
  file.path(result_path, "diamond", "OOG", "8", "local_statistic.csv")
)
# -----------------------------------------------------------------------------
# Step 2: Create Entropy Table
# -----------------------------------------------------------------------------
res_01_entropy_list <- mapply(function(file, method) {
  entropy <- read.csv(file = file)$Shannon_Entropy
  method <- rep(method, length(entropy))
  data.frame(method = method, entropy = entropy)
}, res_01_path, methodnames, SIMPLIFY = FALSE)
res_01_table <- do.call(rbind, res_01_entropy_list)
rownames(res_01_table) <- NULL
res_01_table$coarse_resolution <- "0.1"
res_01_table$fine_resolution <- "0.1"

res_02_entropy_list <- mapply(function(file, method) {
  entropy <- read.csv(file = file)$Shannon_Entropy
  method <- rep(method, length(entropy))
  data.frame(method = method, entropy = entropy)
}, res_02_path, methodnames, SIMPLIFY = FALSE)
res_02_table <- do.call(rbind, res_02_entropy_list)
rownames(res_02_table) <- NULL
res_02_table$coarse_resolution <- "0.1"
res_02_table$fine_resolution <- "0.2"

res_03_entropy_list <- mapply(function(file, method) {
  entropy <- read.csv(file = file)$Shannon_Entropy
  method <- rep(method, length(entropy))
  data.frame(method = method, entropy = entropy)
}, res_03_path, methodnames, SIMPLIFY = FALSE)
res_03_table <- do.call(rbind, res_03_entropy_list)
rownames(res_03_table) <- NULL
res_03_table$coarse_resolution <- "0.2"
res_03_table$fine_resolution <- "0.1"

res_04_entropy_list <- mapply(function(file, method) {
  entropy <- read.csv(file = file)$Shannon_Entropy
  method <- rep(method, length(entropy))
  data.frame(method = method, entropy = entropy)
}, res_04_path, methodnames, SIMPLIFY = FALSE)
res_04_table <- do.call(rbind, res_04_entropy_list)
rownames(res_04_table) <- NULL
res_04_table$coarse_resolution <- "0.2"
res_04_table$fine_resolution <- "0.2"

df_long <- rbind(res_01_table, res_02_table, res_03_table, res_04_table)
df_long$condition <- interaction(df_long$coarse_resolution,
                                 df_long$fine_resolution, sep = "-")
df_long$method <- factor(df_long$method,
                         levels = unique(df_long$method))
df_long$fine_resolution <- factor(df_long$fine_resolution,
                             levels = unique(df_long$fine_resolution))
df_long$coarse_resolution <- factor(df_long$coarse_resolution,
                             levels = unique(df_long$coarse_resolution))
df_long$condition <- factor(df_long$condition,
                            levels = unique(df_long$condition))
rm(res_01_table, res_02_table, methodnames, res_01_path, res_02_path)
# boxplot for mean and median
plot <- ggplot2::ggplot(df_long, aes(x=condition, y=entropy,
                                     color=method, fill=method)) +
  ggplot2::geom_boxplot(alpha=0.5, width = 0.6,
                        outlier.shape = 21, outlier.size = 2) +
  ggplot2::scale_color_manual(values = color_vector) +
  ggplot2::scale_fill_manual(values = color_vector) +
  ggplot2::labs(y = "Harmonized Shannon Entropy") +
  ggplot2::geom_jitter(shape=16, position=position_jitter(0.2)) +
  ggplot2::theme_bw() + ggplot2::theme(axis.title.x = ggplot2::element_blank())

plotname <- file.path("results", "benchmark", "resolution_entropy.pdf")
ggplot2::ggsave(plotname, plot, width = 12, height = 8)